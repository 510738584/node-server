(function(t){function e(e){for(var o,i,s=e[0],u=e[1],c=e[2],l=0,f=[];l<s.length;l++)i=s[l],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(t[o]=u[o]);d&&d(e);while(f.length)f.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,i=1;i<n.length;i++){var u=n[i];0!==a[u]&&(o=!1)}o&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var o={},a={app:0},r=[];function i(t){return s.p+"js/"+({}[t]||t)+"."+{"chunk-2d2086b7":"82a9e9de","chunk-2d22d746":"2849c181"}[t]+".js"}function s(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(t){var e=[],n=a[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise((function(e,o){n=a[t]=[e,o]}));e.push(n[2]=o);var r,u=document.createElement("script");u.charset="utf-8",u.timeout=120,s.nc&&u.setAttribute("nonce",s.nc),u.src=i(t);var c=new Error;r=function(e){u.onerror=u.onload=null,clearTimeout(l);var n=a[t];if(0!==n){if(n){var o=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;c.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",c.name="ChunkLoadError",c.type=o,c.request=r,n[1](c)}a[t]=void 0}};var l=setTimeout((function(){r({type:"timeout",target:u})}),12e4);u.onerror=u.onload=r,document.head.appendChild(u)}return Promise.all(e)},s.m=t,s.c=o,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/",s.oe=function(t){throw console.error(t),t};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],c=u.push.bind(u);u.push=e,u=u.slice();for(var l=0;l<u.length;l++)e(u[l]);var d=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0961":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);var o=n("2b0e"),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",{attrs:{id:"nav"}},[e("router-link",{attrs:{to:"/"}},[t._v("Home")]),t._v(" | "),e("router-link",{attrs:{to:"/protect"}},[t._v("Protect")]),t._v(" | "),t.isLoading?e("a",[t._v("Loading...")]):t.data?[e("a",[t._v(t._s(t.data.loginId))]),e("button",{on:{click:t.handleClick}},[t._v("退出")])]:e("router-link",{attrs:{to:"/login"}},[t._v("Login")])],2),e("router-view")],1)},r=[],i=(n("14d9"),n("2f62")),s={computed:{...Object(i["b"])("loginUser",["isLoading","data"])},methods:{async handleClick(){await this.$store.dispatch("loginUser/loginOut"),this.$router.push("/login").catch(t=>null)}}},u=s,c=(n("a71d"),n("2877")),l=Object(c["a"])(u,a,r,!1,null,null,null),d=l.exports,f=n("8c4f"),p=n("bb51"),g=n("bc3a"),h=function(){let t=localStorage.getItem("token"),e=g["a"];return t&&(e=g["a"].create({headers:{authorization:"bearer "+t}})),e.interceptors.response.use(t=>(t.headers.authorization&&localStorage.setItem("token",t.headers.authorization),t),t=>(403===t.response.status&&localStorage.removeItem("token"),new Promise(t))),e};function m(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}async function v(t,e){await m(2e3);const n=await h().post("/api/admin/login",{loginId:t,loginPwd:e});return n.data}async function b(){await m(2e3),localStorage.removeItem("token")}async function w(){await m(2e3);const t=await h().get("/api/admin/whoami");return t.data}var y={namespaced:!0,state:{isLoading:!1,data:null},mutations:{setLoading(t,e){t.isLoading=e},setData(t,e){t.data=e}},actions:{async login({commit:t},{loginId:e,loginPwd:n}){t("setLoading",!0);const o=await v(e,n);return t("setData",o.data),t("setLoading",!1),o},async loginOut({commit:t}){t("setLoading",!0),t("setData",null),await b(),t("setLoading",!1)},async whoAmI({commit:t}){t("setLoading",!0);try{const e=await w();console.log(e),t("setData",e.data)}catch(e){t("setData",null)}t("setLoading",!1)}}};o["a"].use(i["a"]);var _=new i["a"].Store({modules:{loginUser:y}});o["a"].use(f["a"]);const k=[{path:"/",name:"Home",component:p["default"]},{path:"/protect",component:()=>n.e("chunk-2d22d746").then(n.bind(null,"f820")),beforeEnter(t,e,n){_.state.loginUser.data?n():(alert("此页面需要登陆后才能访问"),n("/login"))}},{path:"/login",component:()=>n.e("chunk-2d2086b7").then(n.bind(null,"a55b"))}],O=new f["a"]({mode:"history",base:"/",routes:k});var P=O;_.dispatch("loginUser/whoAmI"),o["a"].config.productionTip=!1,new o["a"]({router:P,store:_,render:t=>t(d)}).$mount("#app")},"7ad4":function(t,e,n){"use strict";var o=n("9cae"),a=n.n(o);e["default"]=a.a},"8e24":function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a}));var o=function(){var t=this;t._self._c,t._self._setupProxy;return t._m(0)},a=[function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"home"},[e("img",{attrs:{alt:"Vue logo",src:n("cf05")}}),e("h1",[t._v("这是一个公共页面，可以匿名访问")])])}]},"9cae":function(t,e){},a71d:function(t,e,n){"use strict";n("0961")},bb51:function(t,e,n){"use strict";var o=n("8e24"),a=n("7ad4"),r=n("2877"),i=Object(r["a"])(a["default"],o["a"],o["b"],!1,null,null,null);e["default"]=i.exports},cf05:function(t,e,n){t.exports=n.p+"img/logo.82b9c7a5.png"}});
//# sourceMappingURL=app.508bea9f.js.map